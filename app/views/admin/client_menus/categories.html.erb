<div class="menu-header">
  <div class="menu-header__name">
    <%= @client.full_name %>
  </div>

  <div class="menu-header__date">
    <%= l(@client_menu.job_date, format: :full_month) %>
  </div>

  <div class="menu-header__nav hamburger-nav">
    <button class="hamburger-nav__control" @click="toggleNav">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <div class="hamburger-nav__body" v-if="navOpen">
      <%= link_to 'Edit', edit_admin_client_menu_path(@client_menu) %>
      <a href="" @click="clickDuplicate($event)">Copy Menu</a>
      <a :href="menu.slug_url" target="_blank">Public View</a>
      <a :href="`/admin/client_menus/${menu.id}/send_to_client`" @click="clickSendToClient($event)">Send to Client</a>
    </div>
  </div>
</div>

<div class="menu-nav">
  <div class="menu-nav__section">
    <%= active_link_to 'Categories', admin_client_menu_categories_path(@client_menu) %>
    <%= active_link_to 'Menu Items', admin_client_menu_menu_items_path(@client_menu) %>
  </div>

  <div class="menu-nav__section">
    <%= active_link_to 'Results', admin_client_menu_results_path(@client_menu) %>
  </div>
</div>

<div class="menu-body">
  <% if @categories.empty? %>

    <div class="empty">
      <div class="empty__text">
        No categories. Add one now!
      </div>

      <div class="empty__control">
        <button class="button button--light" @click="clickAdd">+ Add Category</button>
      </div>
    </div>

  <% else %>

    <div class="categories-list">
      <div class="sortable-list">
        <% @categories.each do |category| %>
          <div class="sortable-item" data-category-id="<%= category.id %>">
            <div class="sortable-item__move">
              <span></span>
              <span></span>
              <span></span>
            </div>

            <a href="" @click="clickEdit(category, $event)">
              <%= category.name %>
            </a>
          </div>
        <% end %>
      </div>

      <button class="button button--light" @click="clickAdd">+ Add Category</button>
    </div>

  <% end %>
</div>

<script>
  const url = '<%= admin_client_menu_update_category_weights_path(@client_menu) %>';

  $('.sortable-list').sortable({
    handle: '.sortable-item__move',

    update: function() {
      const weights = $('[data-category-id]').map(function() {
        return $(this).data('category-id');
      }).get();

      $.ajax({
        url: url,
        method: 'POST',
        data: { weights: weights }
      });
    }
  });
</script>
